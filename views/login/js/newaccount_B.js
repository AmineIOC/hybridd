PRNG={};PRNG.seeder={init:function(){document.getElementById("generatekeyinput").value=""}(),restart:function(){PRNG.seeder.seedCount=0;PRNG.seeder.isStillSeeding=true;$("html").css("overflow","hidden");document.getElementById("newaccountmodal").style.display="block";document.getElementById("newaccountcontent").style.display="block";document.getElementById("generate").style.display="block";document.getElementById("mousemovelimit").innerHTML="0%"},seedLimit:function(){var num=Crypto.util.randomBytes(12)[11];return 200+Math.floor(num)}(),seedCount:0,lastInputTime:(new Date).getTime(),seedPoints:[],isStillSeeding:true,seed:function(evt){if(!evt)var evt=window.event;var timeStamp=(new Date).getTime();if(PRNG.seeder.seedCount==PRNG.seeder.seedLimit){PRNG.seeder.seedCount++;PRNG.seeder.seedingOver()}else if(PRNG.seeder.seedCount<PRNG.seeder.seedLimit&&evt&&timeStamp-PRNG.seeder.lastInputTime>40){SecureRandom.seedTime();SecureRandom.seedInt16(evt.clientX*evt.clientY);PRNG.seeder.showPoint(evt.clientX,evt.clientY);PRNG.seeder.seedCount++;PRNG.seeder.lastInputTime=(new Date).getTime();PRNG.seeder.showPool()}},seedKeyPress:function(evt){if(!evt)var evt=window.event;if(PRNG.seeder.seedCount==PRNG.seeder.seedLimit){PRNG.seeder.seedCount++;PRNG.seeder.seedingOver()}else if(PRNG.seeder.seedCount<PRNG.seeder.seedLimit&&evt.which){var timeStamp=(new Date).getTime();SecureRandom.seedTime();SecureRandom.seedInt8(evt.which);var keyPressTimeDiff=timeStamp-PRNG.seeder.lastInputTime;SecureRandom.seedInt8(keyPressTimeDiff);PRNG.seeder.seedCount++;PRNG.seeder.lastInputTime=(new Date).getTime();PRNG.seeder.showPool()}},showPool:function(){var poolHex;if(SecureRandom.poolCopyOnInit!=null){poolHex=Crypto.util.bytesToHex(SecureRandom.poolCopyOnInit);document.getElementById("seedpool").innerHTML=poolHex;document.getElementById("seedpooldisplay").innerHTML=poolHex}else{poolHex=Crypto.util.bytesToHex(SecureRandom.pool);document.getElementById("seedpool").innerHTML=poolHex;document.getElementById("seedpooldisplay").innerHTML=poolHex}var percentSeeded=Math.round(PRNG.seeder.seedCount/PRNG.seeder.seedLimit*100)+"%";document.getElementById("mousemovelimit").innerHTML=percentSeeded},showPoint:function(x,y){var div=document.createElement("div");div.setAttribute("class","seedpoint");div.style.top=y+"px";div.style.left=x+"px";document.body.appendChild(div);PRNG.seeder.seedPoints.push(div)},removePoints:function(){for(var i=0;i<PRNG.seeder.seedPoints.length;i++){document.body.removeChild(PRNG.seeder.seedPoints[i])}PRNG.seeder.seedPoints=[]},seedingOver:function(){PRNG.seeder.isStillSeeding=false;document.getElementById("generate").style.display="none";document.getElementById("newaccountcontent").style.display="none";document.getElementById("newaccountmodal").style.display="none";$("html").css("overflow","");PRNG.seeder.removePoints();generateAccount(document.getElementById("seedpooldisplay").innerHTML)}};function generateAccount(entropy){confirm("Do you want a medium or high security wallet? A medium security wallet has a much shorter password, which is easier to remember.            However, we do advise not to store more than a month's wage worth of value in a medium security wallet.           High security wallets have a very long password, making them more secure.",function(mediumlevel){if(mediumlevel){var offset=Math.floor(Math.random()*(511-20));var userid=hexToBase32(entropy.substr(offset,20));var passwd=hexToBase32(entropy.substr(offset+20,20));finalizeAccount(userid,passwd,entropy)}else{var offset=Math.floor(Math.random()*(511-100));var userid=hexToBase32(entropy.substr(offset,20));var passwd=hexToBase32(entropy.substr(offset+20,60));finalizeAccount(userid,passwd,entropy)}},{done:{text:"Medium",default:true},cancel:{text:"High",default:false}})}function finalizeAccount(userid,passwd,entropy){alert('<h3>New Account Created</h3>Your account has been created. Please <u>write down</u> these login details and put them in a safe place. If you lose them, you can <u>never ever</u> log into your wallet again!         <br/><br/><div style="border-radius: 8px;color: #555;border: #CCC 1px solid;padding: 12px;background: #EEE;">        <table style="margin-left:25%;width:90%;"><tbody><tr><td style="min-width:100px;padding-bottom:8px;">Account ID</td><td><b style="color:#080;">'+userid+'</b></td></tr><tr><td>Password</td><td><b style="color:#A33;width: 12em;display: block;overflow-wrap: break-word;">'+passwd+'</b></td></tr></tbody></table></div><br/>         We cannot help you recover the keys, so they are <u>your responsibility</u>!        Have a lot of fun using Internet of Coins!        <br /><small><br /><span style="font-size: 1em;">âš </span> WARNING: This wallet is stil in alpha!<br />Do not yet store large amounts of value on it!</small>',{title:"",button:"Close"},function(){confirm("Did you write down your login details and put them in a safe place? If not, you will get new login credentials.",function(result){if(!result){generateAccount(entropy)}},{done:{text:"Yes"},cancel:{text:"No",default:true}})});document.getElementById("inputUserID").value=userid;document.getElementById("inputPasscode").value=passwd;checkfields()}
