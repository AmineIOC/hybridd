init.interface.assets=function(args){topmenuset("assets");clearInterval(intervals);scrollToAnchor=function(){if(args.element!==null&&args.element!==undefined){$("html, body").animate({scrollTop:$("#"+args.element).offset().top-250},500)}};clipb_success=function(){$("#action-receive .copied").fadeTo("fast",1);$("#action-receive .copied").delay(10).fadeTo("fast",.3);$("#action-receive .copied").delay(10).fadeTo("fast",1);$("#action-receive .copied").delay(800).fadeTo("fast",0)};clipb_fail=function(err){alert("This browser cannot automatically copy to the clipboard! \n\nPlease select the text manually, and press CTRL+C to \ncopy it to your clipboard.\n")};$("#send-transfer").click(function(){if($("#send-transfer").hasClass("disabled")){}else{loadSpinner();var symbol=$("#action-send .modal-send-currency").attr("asset");sendTransaction({element:".assets-main > .data .balance-"+symbol.replace(/\./g,"-"),elementbase:".assets-main > .data .balance-"+symbol.split(".")[0],asset:symbol,amount:Number($("#modal-send-amount").val().replace(/\,/g,".")),source:String($("#action-send .modal-send-addressfrom").html()).trim(),target:String($("#modal-send-target").val()).trim()})}});$("#save-assetlist").click(function(){var array=[];for(var entry in GL.assetnames){var entryExists=GL.assetSelect[entry];if(entryExists){array.push(entry);initAsset(entry,GL.assetmodes[entry])}}GL.assetsActive=array;var newAssetsToStar=GL.assetsActive.filter(function(asset){var foundOrUndefinedId=GL.assetsStarred.find(function(starred){return starred.id===asset});return foundOrUndefinedId===undefined});GL.assetsStarred=GL.assetsActive.map(function(asset){var foundOrUndefinedId=GL.assetsStarred.find(function(starred){return asset===starred.id});return foundOrUndefinedId===undefined?{id:asset,starred:false}:foundOrUndefinedId});storage.Set(userStorageKey("ff00-0033"),userEncode(array));storage.Set(userStorageKey("ff00-0034"),userEncode(GL.assetsStarred));displayAssets()});GL.searchingactive=false;GL.searchval="";$("#search-assets").on("change keydown paste input",function(){if(!GL.searchingactive){GL.searchingactive=true;setTimeout(function(){if($("#search-assets").val()!==GL.searchval){renderManageAssetsList(GL.assetnames,$("#search-assets").val());GL.searchval=$("#search-assets").val()}GL.searchingactive=false},250)}});manageAssets=function manageAssets(){GL.assetSelect=[];renderManageAssetsList(GL.assetnames)};renderManageAssetsList=function renderManageAssetsList(list,search){console.log("list = ",list);if(typeof search!=="undefined"){search=search.toLowerCase()}for(var entry in GL.assetnames){var hasCorrectType=typeof GL.assetSelect[entry]==="undefined"||typeof GL.assetSelect[entry]==="function";if(GL.assetsActive.indexOf(entry)===-1){if(hasCorrectType){GL.assetSelect[entry]=false}}else{if(hasCorrectType){GL.assetSelect[entry]=true}}}var output='<div class="table">'+'<div class="thead">'+'<div class="tr">'+'<div class="th col1">Asset</div>'+'<div class="th col2" style="text-align:right;">Add / remove from wallet</div>'+"</div>"+"</div>"+'<div class="tbody">';var element;for(var entry in list){if(typeof search==="undefined"||entry.toLowerCase().indexOf(search)!==-1||list[entry].toLowerCase().indexOf(search)!==-1){var symbolName=entry.slice(entry.indexOf(".")+1);var icon=symbolName in black.svgs?black.svgs[symbolName]:mkSvgIcon(symbolName);var entryExists=GL.assetsActive.includes(entry);element=entry.replace(".","-");output+='<div class="tr">';output+='<div class="td col1"><div class="icon">'+icon+'</div><div class="asset">'+entry.toUpperCase()+'</div><div class="full-name">'+list[entry]+"</div></div>";output+='<div class="td col2 actions"><div class="assetbuttons assetbuttons-'+element+'">'+renderManageButton(element,entry,entryExists)+"</div></div>";output+="</div>"}}output+="</div></div>";$("#manage-assets .data").html(output)};renderManageButton=function renderManageButton(element,asset,active){return"<a onclick=\"changeManageButton('"+element+"','"+asset+"',"+(active?0:1)+');" class="pure-button '+(active?"pure-button-error selectedAsset":"pure-button-success")+'" role="button"><div class="actions-icon">'+(active?svg["remove"]:svg["add"])+"</div>"+(active?"Remove":"Add")+"</a>"};changeManageButton=function changeManageButton(element,asset,active){if(active){GL.assetSelect[asset]=true}else{GL.assetSelect[asset]=false}$("#manage-assets .assetbuttons-"+element).html(renderManageButton(element,asset,active))};setStarredAssetClass=function(i,isStarred){var id="#"+GL.assetsStarred[i]["id"].replace(/\./g,"_");$(id).children("svg").toggleClass("starred",isStarred)};toggle_star=function(i){var isStarred=GL.assetsStarred[i]["starred"]=!GL.assetsStarred[i]["starred"];storage.Get(userStorageKey("ff00-0034"),function(assetsStarred){var newAssetsStarred=userDecode(assetsStarred).map(function(asset){var sameOrModifiedStarredAsset=asset.id===GL.assetsStarred[i]["id"]?{id:GL.assetsStarred[i]["id"],starred:isStarred}:asset;return sameOrModifiedStarredAsset});storage.Set(userStorageKey("ff00-0034"),userEncode(newAssetsStarred))});setStarredAssetClass(i,isStarred)};fill_actions=function(asset){var element=".assets-main > .data .balance-"+asset.replace(/\./g,"-");$("#action-actions #ModalLabel").html(asset.toUpperCase());$("#action-actions .balance").html($(element).html().toUpperCase());var output="";output+="<a onclick='fill_send(\""+asset+'");\' href="#action-send" class="pure-button pure-button-large pure-button-fw pure-button-primary" role="button" data-dismiss="modal" data-toggle="modal">Send</a>';output+="<a onclick='fill_recv(\""+asset+'");\' href="#action-receive" class="pure-button pure-button-large pure-button-fw pure-button-secondary" role="button" data-dismiss="modal" data-toggle="modal">Receive</a>';output+='<a href="#action-advanced" class="pure-button pure-button-grey pure-button-large pure-button-fw advanced-button" role="button" data-dismiss="modal" data-toggle="modal"><div class="advanced-icon">'+svg["advanced"]+"</div>Advanced</a>";$("#action-actions .buttons").html(output)};fill_send=function(asset){var element=".assets-main > .data .balance-"+asset.replace(/\./g,"-");var balance=$(element).attr("amount");if(balance&&balance!=="?"){if(!isToken(asset)){var spendable=toInt(balance).minus(toInt(assets.fees[asset]))}else{var spendable=toInt(balance)}if(spendable<0){spendable=0}$("#action-send .modal-send-currency").html(asset.toUpperCase());$("#action-send .modal-send-currency").attr("asset",asset);$("#action-send .modal-send-balance").html(formatFloat(spendable));$("#modal-send-target").val("");$("#modal-send-amount").val("");$("#action-send .modal-send-addressfrom").html(assets.addr[asset]);$("#action-send .modal-send-networkfee").html(formatFloat(assets.fees[asset])+" "+asset.split(".")[0].toUpperCase());check_tx()}};fill_recv=function(asset){$("#action-receive .modal-receive-currency").html(asset.toUpperCase());$("#action-receive .modal-receive-addressfrom").html(assets.addr[asset]);$("#modal-receive-button").attr("data-clipboard-text",$("#action-receive .modal-receive-addressfrom").html());clipboardButton("#modal-receive-button",clipb_success,clipb_fail);$("#action-receive .modal-receive-status").attr("id","receivestatus-"+asset);$("#qrcode").html("").append(function(){new QRCode(document.getElementById("qrcode"),{text:assets.addr[asset],width:160,height:160,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})})};stop_recv=function(){$("#action-receive .modal-receive-status").attr("id","receivestatus")};check_tx=function(){var p={};p.asset=$("#action-send .modal-send-currency").attr("asset");p.target_address=String($("#modal-send-target").val());p.amount=Number($("#modal-send-amount").val());p.available=Number($("#action-send .modal-send-balance").html());if(!isNaN(p.amount)&&p.amount>0&&p.amount<=p.available&&p.target_address){$("#action-send .pure-button-send").removeClass("disabled")}else{$("#action-send .pure-button-send").addClass("disabled")}};ui_assets=function(properties){var i;for(i=0;i<GL.assetsActive.length;i++){setTimeout(function(i){if(typeof balance.asset[i]!=="undefined"){var element=".assets-main > .data .balance-"+balance.asset[i].replace(/\./g,"-");if(balance.lasttx[i]+12e4<(new Date).getTime()){hybriddcall({r:"a/"+balance.asset[i]+"/balance/"+assets.addr[balance.asset[i]],z:0},element,function(object){var assetbuttons=".assets-main > .data .assetbuttons-"+balance.asset[i].replace(/\./g,"-");if(object.data!==null&&!isNaN(object.data)){renderDollarPriceInAsset(balance.asset[i],Number(object.data));$(assetbuttons).delay(1e3).removeClass("disabled");$(assetbuttons+" a").removeAttr("disabled");$(assetbuttons+" a").attr("data-toggle","modal");$(element).attr("amount",object.data);object.data=UItransform.formatFloat(object.data)}else{$(assetbuttons).addClass("disabled");$(assetbuttons+" a").removeAttr("data-toggle");$(element).attr("amount","?");object.data="n/a"}return object})}}},i*500,i)}setTimeout(getNewMarketPrices,5e3)}};function getNewMarketPrices(){getDollarPrices(()=>{})}function renderDollarPriceInAsset(asset,amount){var symbolName=asset.slice(asset.indexOf(".")+1);var assetDollarPrice=renderDollarPrice(symbolName,amount);var query=document.getElementById(symbolName+"-dollar");if(query!==null){query.innerHTML=assetDollarPrice}}
