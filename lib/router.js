var functions=require("./functions");var LZString=require("./crypto/lz-string");var UrlBase64=require("./crypto/urlbase64");var asset=require("./router/asset");var command=require("./router/command");var list=require("./router/list");var help=require("./router/help");var proc=require("./router/proc");var source=require("./router/source");var engine=require("./router/engine");var view=require("./router/view");var xauth=require("./router/xauth");var url=require("url");exports.route=route;var routeRootMap={asset:asset.process,command:command.process,engine:engine.process,list:list.process,help:help.serve,proc:proc.process,source:source.process,view:view.serve,xauth:xauth.processX,ychan:xauth.processY,zchan:xauth.processZ};function route(request,modules){if(typeof request.url==="string"){var xpath=request.url.split("/");for(var i=0;i<xpath.length;i++){if(xpath[i]===""){xpath.splice(i,1);i--}else{xpath[i]=decodeURIComponent(xpath[i])}}var result={error:1,info:"Your request was not understood!"};if(JSON.stringify(xpath)!==JSON.stringify(global.hybridd.last_routed_xpath)&&xpath[0]!=="y"&&xpath[0]!=="z"){console.log(" [i] routing request "+JSON.stringify(xpath))}global.hybridd.last_routed_xpath=xpath;if(xpath.length===0){result={info:" *** Welcome to the hybridd JSON REST-API. Please enter a path. For example: /asset/btc/command/help *** ",error:0,id:null}}else{var node;if(routeRootMap.hasOwnProperty(xpath[0])){node=xpath[0]}else if(global.hybridd.routetree.hasOwnProperty(xpath[0])&&global.hybridd.routetree[xpath[0]].hasOwnProperty("_alias")&&routeRootMap.hasOwnProperty(global.hybridd.routetree[xpath[0]]["_alias"])){node=global.hybridd.routetree[xpath[0]]["_alias"]}if(node){result=routeRootMap[node](request,xpath)}if(typeof xpath[0]==="undefined"||xpath[0].length<=1){result.info=undefined}}return JSON.stringify(result)}return'{error:1, info:"Your request was ill formatted!"}'}
