exports.main=main;var _=require("./underscore");var http=require("http");var fs=require("fs");var ini=require("./ini");global.hybridd=ini.parse(fs.readFileSync("../hybridd.conf","utf-8"));global.hybridd.proc={};global.hybridd.procqueue={};global.hybridd.xauth={};global.hybridd.xauth.session=[];last_xpath="";modules=require("./modules");scheduler=require("./scheduler");function main(route){modules.init();function onRequest(request,response){request.public=false;request.private=true;response.writeHead(200,{"Content-Type":"application/json"});response.write(route(request,modules));response.end()}http.createServer(onRequest).listen(global.hybridd.restport,global.hybridd.restbind);console.log(" [i] REST API running on: http://"+global.hybridd.restbind+":"+global.hybridd.restport);scheduler.initialize();if(typeof global.hybridd.userport!="undefined"){function onUIRequest(request,response){if(request.url.indexOf("/api",0,4)==-1){var index_html=fs.readFileSync("../views/index.html","utf8");response.writeHead(200,{"Content-Type":"text/html"});response.write(index_html);response.end()}else{request.public=true;request.private=false;request.url=request.url.substring(4);response.writeHead(200,{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"});response.write(route(request,modules));response.end()}}var userport=typeof global.hybridd.userport!="undefined"?global.hybridd.userport:8080;http.createServer(onUIRequest).listen(userport,global.hybridd.userbind);console.log(" [i] user interface running on: http://"+global.hybridd.userbind+":"+global.hybridd.userport)}setInterval(function(){var maxentries=typeof global.hybridd.cacheidx!="undefined"&&global.hybridd.cacheidx>0?global.hybridd.cacheidx:100;var cachedarray=Object.keys(cached);if(cachedarray.length>maxentries){for(var i=0;i<cachedsize-maxentries;i++){delete cached[cachedarray[i]]}}},1e3)}
