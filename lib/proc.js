exports.process=process;exports.cacheAdd=cacheAdd;exports.cacheGet=cacheGet;function process(request){var result=null;if(xpath.length==1){result=proclist()}else{if(xpath[1]=="peek"&&!request.public){if(xpath.length==3){result=procdata(xpath[2],true)}}else{if(xpath[1]=="queue"&&!request.public){if(xpath.length==3){if(typeof global.hybridd.procqueue[xpath[2]]!="undefined"){result={error:0,info:"Queue item.",id:xpath[2],data:global.hybridd.procqueue[xpath[2]]}}else{result={error:1,info:"The queue item specified does not exist!"}}}else{result=queuelist()}}else{result=procdata(xpath[1])}}}return result}function queuelist(){var qcnt=0;var queue=[];for(var key in global.hybridd.procqueue){queue[qcnt]=key;qcnt++}return{error:0,info:"List of queue items.",id:"proc/queue",count:qcnt,data:queue}}function proclist(){var proccnt=0;var sproccnt=0;var procs=[];for(var key in global.hybridd.proc){if(key.indexOf(".",15)==-1){procs[proccnt]=key;proccnt++}else{sproccnt++}}return{error:0,info:"List of processes.",id:"proc",count:proccnt,subprocesses:sproccnt,data:procs}}function procdata(processID,peek){if(typeof global.hybridd.proc[processID]!="undefined"){if(peek){var result=global.hybridd.proc[processID]}else{var err=global.hybridd.proc[processID].err;var info=typeof global.hybridd.proc[processID].info!="undefined"?global.hybridd.proc[processID].info:"Process data.";var result={error:err?err:0,info:info,id:processID,progress:global.hybridd.proc[processID].progress,started:global.hybridd.proc[processID].started,stopped:global.hybridd.proc[processID].stopped,data:global.hybridd.proc[processID].data}}}else{var result={error:1,info:"The process specified does not exist!"}}return result}function cacheAdd(index,data){cached[index]=[Date.now(),data]}function cacheGet(index,millisecs){if(millisecs<100){millisecs=100}if(typeof cached[index]!="undefined"&&typeof cached[index][0]!="undefined"){if(cached[index][0]>Date.now()-millisecs){if(DEBUG){console.log(" [D] cache hit for index: "+index)}return cached[index][1]}else{delete cached[index];return null}}else{return null}}
