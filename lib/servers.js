var http=require("http");var router=require("./router");function onRequest(request,response){request.sessionID=1;var res_data=router.route(request,modules);var P=JSON.parse(res_data);if(P["content"]==="html"){response.writeHead(200,{"Content-Type":"text/html","Access-Control-Allow-Origin":"*"});response.write(P["data"])}else{response.writeHead(200,{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"});response.write(res_data)}response.end()}var local={init:function(callbackArray){var restinterface=typeof global.hybridd.restinterface!=="undefined"?global.hybridd.restinterface:"enabled";if(restinterface==="enabled"&&!global.hybridd.restServer){global.hybridd.restServer=http.createServer(onRequest);global.hybridd.restServer.listen(global.hybridd.restport,global.hybridd.restbind,undefined,function(){console.log(` [i] local rest interface running on: http://${global.hybridd.restbind}:${global.hybridd.restport}`);functions.sequential(callbackArray)}.bind({callbackArray:callbackArray}))}else{functions.sequential(callbackArray)}},close:function(callbackArray){var restinterface=typeof global.hybridd.restinterface!=="undefined"?global.hybridd.restinterface:"enabled";if(restinterface==="enabled"&&global.hybridd.restServer&&global.hybridd.restServer.listening){global.hybridd.restServer.close(function(){console.log("[i] rest interface has been closed.");functions.sequential(callbackArray)})}else{functions.sequential(callbackArray)}},listen:function(callbackArray){global.hybridd.restServer.listen(global.hybridd.restport,global.hybridd.restbind,undefined,function(){console.log(` [i] local rest interface running on: http://${global.hybridd.restbind}:${global.hybridd.restport}`);functions.sequential(callbackArray)}.bind({callbackArray:callbackArray}))}};function onUIRequest(request,response){if(request.url.indexOf("/api",0,4)===-1){if(request.url.indexOf("/favicon.ico",0,12)!==-1){var index_html=fs.readFileSync("../views/favicon.ico")}else if(request.url.indexOf("/files/",0,7)!==-1){var filename="../views/files/"+request.url.substr(7).replace("..","");if(fs.existsSync(filename)){var index_html=fs.readFileSync(filename,"utf8")}else{var index_html=""}}else{var index_html=fs.readFileSync("../views/index.html","utf8")}response.writeHead(200,{"Content-Type":"text/html"});response.write(index_html);response.end()}else{request.sessionID=0;request.url=request.url.substring(4);var res_data=router.route(request,modules);response.writeHead(200,{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"});response.write(res_data);response.end()}}var public={init:function(callbackArray){if(typeof global.hybridd.userport!=="undefined"){var userinterface=typeof global.hybridd.userinterface!=="undefined"?global.hybridd.userinterface:"enabled";if(userinterface==="enabled"){var userport=typeof global.hybridd.userport!=="undefined"?global.hybridd.userport:8080;global.hybridd.uiServer=http.createServer(onUIRequest);global.hybridd.uiServer.listen(userport,global.hybridd.userbind,undefined,function(){console.log(` [i] public user interface running on: http://${global.hybridd.userbind}:${global.hybridd.userport}`);functions.sequential(callbackArray)}.bind({callbackArray:callbackArray}))}else{functions.sequential(callbackArray)}}else{functions.sequential(callbackArray)}},close:function(callbackArray){var userinterface=typeof global.hybridd.userinterface!=="undefined"?global.hybridd.userinterface:"enabled";if(userinterface==="enabled"&&global.hybridd.uiServer&&global.hybridd.uiServer.listening){global.hybridd.uiServer.close(function(){console.log("[i] user interface has been closed.");functions.sequential(callbackArray)})}else{functions.sequential(callbackArray)}},listen:function(callbackArray){var userport=typeof global.hybridd.userport!=="undefined"?global.hybridd.userport:8080;global.hybridd.uiServer.listen(userport,global.hybridd.userbind,undefined,function(){console.log(` [i] public user interface running on: http://${global.hybridd.userbind}:${global.hybridd.userport}`);functions.sequential(callbackArray)}.bind({callbackArray:callbackArray}))}};exports.local={};exports.public={};exports.local.init=local.init;exports.local.close=local.close;exports.local.listen=local.listen;exports.public.init=public.init;exports.public.close=public.close;exports.public.listen=public.listen;
